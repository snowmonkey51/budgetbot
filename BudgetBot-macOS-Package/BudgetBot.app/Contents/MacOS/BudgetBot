#!/bin/bash

# BudgetBot Native macOS App Launcher
cd "/Applications/BudgetBot-macOS-Final"

# Check if BudgetBot is installed
if [ ! -d "/Applications/BudgetBot-macOS-Final" ]; then
    osascript -e 'display dialog "BudgetBot not found in /Applications/BudgetBot-macOS-Final\n\nPlease install BudgetBot first." with title "BudgetBot" buttons {"OK"} default button "OK"'
    exit 1
fi

# Add common Node.js paths to PATH
export PATH="/usr/local/bin:/opt/homebrew/bin:$PATH"

# Check if Node.js is available
if ! command -v node &> /dev/null; then
    osascript -e 'display dialog "Node.js is required but not found.\n\nPlease install Node.js 18+ from nodejs.org" with title "BudgetBot" buttons {"OK"} default button "OK"'
    open "https://nodejs.org/"
    exit 1
fi

# Check if dependencies are installed
if [ ! -d "node_modules" ]; then
    # Show installation dialog
    osascript -e 'display dialog "Installing BudgetBot dependencies...\n\nThis may take a few minutes." with title "BudgetBot Setup" buttons {"OK"} default button "OK"'
    
    # Install dependencies
    npm install
fi

# Start BudgetBot in background
export PATH="/usr/local/bin:/opt/homebrew/bin:$PATH"
npm run dev &
NODE_PID=$!

# Wait a moment for server to start
sleep 3

# Open browser
open "http://localhost:5000"

# Show success dialog
osascript -e 'display dialog "BudgetBot is now running!\n\nAccess it at: http://localhost:5000\n\nTo stop BudgetBot, close this dialog and quit the Terminal app." with title "BudgetBot Running" buttons {"OK"} default button "OK"'

# Keep the process running
wait $NODE_PID
